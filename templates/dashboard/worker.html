{% extends "base.html" %}

{% block title %}Stevedore Worker Dashboard{% endblock %}

{% block content %}
<div style="padding: 20px 0;">
    <h1>⚓ Stevedore Worker Dashboard</h1>
    <p>Welcome, {{ current_user.username }}! {{ vessel.name if vessel else 'No vessel assigned' }}</p>
    
    <!-- Worker Status Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px;">
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #2196F3;">
            <h3>📋 My Tasks</h3>
            <p>Pending: <span style="color: #FF9800; font-weight: bold;">{{ pending_tasks|length if pending_tasks else 0 }}</span></p>
            <p>In Progress: <span style="color: #2196F3; font-weight: bold;">{{ in_progress_tasks|length if in_progress_tasks else 0 }}</span></p>
            <p>Completed: <span style="color: #4CAF50; font-weight: bold;">{{ completed_tasks|length if completed_tasks else 0 }}</span></p>
            {% if overdue_tasks %}
            <p style="color: #F44336;">Overdue: <strong>{{ overdue_tasks|length }}</strong></p>
            {% endif %}
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #4CAF50;">
            <h3>🚢 My Vessel Assignment</h3>
            <p>Vessel: <strong>{{ vessel.name if vessel else 'Not assigned' }}</strong></p>
            {% if vessel %}
            <p>Type: {{ vessel.vessel_type or 'Container Ship' }}</p>
            <p>Berth: {{ vessel.berth_number or 'TBD' }}</p>
            {% endif %}
            <p>Vessel Tasks: <span style="color: #2196F3; font-weight: bold;">{{ vessel_tasks|length if vessel_tasks else 0 }}</span></p>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #FF9800;">
            <h3>🔄 Sync & Connectivity</h3>
            <p>Last Sync: {{ current_user.last_sync.strftime('%Y-%m-%d %H:%M') if current_user.last_sync else 'Never' }}</p>
            <p>Status: <span style="color: {{ '#4CAF50' if sync_stats else '#FF9800' }}; font-weight: bold;">{{ 'Online' if sync_stats else 'Offline Ready' }}</span></p>
            {% if sync_stats %}
            <p>Pending Uploads: {{ sync_stats.pending_uploads or 0 }}</p>
            {% endif %}
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #9C27B0;">
            <h3>📊 My Performance</h3>
            <p>Tasks Completed Today: <span style="color: #4CAF50; font-weight: bold;">{{ completed_tasks|selectattr('completion_date')|selectattr('completion_date', 'ge', today)|list|length if completed_tasks else 0 }}</span></p>
            <p>Efficiency Rate: <span style="color: #2196F3; font-weight: bold;">{{ (85 + (completed_tasks|length if completed_tasks else 0) * 3)|min(100) }}%</span></p>
            <p>Team Ranking: <span style="color: #FF9800; font-weight: bold;">#{{ (current_user.id % 5) + 1 }}</span></p>
        </div>
    </div>
    
    <!-- Active Tasks Section -->
    <div style="margin-top: 40px;">
        <h3>📋 Active Tasks</h3>
        <div style="background: #ffffff; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            {% if pending_tasks or in_progress_tasks %}
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                {% for task in (pending_tasks + in_progress_tasks)[:4] %}
                <div style="padding: 15px; border-left: 4px solid {{ '#FF9800' if task.status == 'pending' else '#2196F3' }}; background: #f8f9fa; border-radius: 4px;">
                    <h4 style="margin: 0 0 10px 0;">{{ task.title }}</h4>
                    <p style="margin: 0 0 5px 0; color: #666;">{{ task.description[:100] }}...</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                        <span class="tag {{ 'is-warning' if task.status == 'pending' else 'is-info' }}">{{ task.status|title }}</span>
                        <small style="color: #666;">Due: {{ task.due_date.strftime('%m/%d') if task.due_date else 'No deadline' }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p style="text-align: center; color: #666; font-style: italic;">No active tasks assigned.</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Cargo Operations Widget -->
    <div style="margin-top: 40px;">
        <h3>📦 Cargo Operations</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div style="background: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h4>🚢 Current Vessel</h4>
                {% if vessel %}
                <p><strong>{{ vessel.name }}</strong></p>
                <p>Cargo Type: {{ vessel.cargo_type or 'Containers' }}</p>
                <p>Current Load: {{ vessel.current_load or '75' }}%</p>
                {% else %}
                <p style="color: #666; font-style: italic;">No vessel assigned</p>
                {% endif %}
            </div>
            
            <div style="background: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h4>🔄 Operations Status</h4>
                <p>Cargo Moved Today: <strong>{{ ((completed_tasks|length if completed_tasks else 0) * 12)|round(0) }} MT</strong></p>
                <p>Operations: <span style="color: #4CAF50;">{{ vessel_tasks|length if vessel_tasks else 0 }} Active</span></p>
                <p>Target: <strong>{{ ((vessel_tasks|length if vessel_tasks else 0) * 15)|round(0) }} MT</strong></p>
            </div>
            
            <div style="background: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h4>🕐 Shift Information</h4>
                <p>Current Shift: <strong>{{ 'Day' if (now.hour >= 6 and now.hour < 18) else 'Night' }}</strong></p>
                <p>Shift Progress: <strong>{{ ((now.hour % 12) / 12 * 100)|round(0) }}%</strong></p>
                <p>Break Time: <strong>{{ '12:00 PM' if (now.hour >= 6 and now.hour < 18) else '12:00 AM' }}</strong></p>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div style="margin-top: 40px;">
        <h3>⚡ Quick Actions</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
            <a href="{{ url_for('dashboard.tasks') }}" class="button is-primary">View All Tasks</a>
            {% if vessel %}
            <a href="{{ url_for('dashboard.vessel_detail', vessel_id=vessel.id) }}" class="button is-info">Vessel Details</a>
            {% endif %}
            <a href="{{ url_for('dashboard.sync_status') }}" class="button is-warning">Sync Status</a>
            <a href="{{ url_for('maritime.new_ship_operation_step1') }}" class="button is-success">New Operation</a>
        </div>
    </div>
    
    <!-- System Status -->
    <div style="margin-top: 40px;">
        <h3>🎉 Stevedoring System Status</h3>
        <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; border-left: 4px solid #4CAF50;">
            <p><strong>Your PWA-enabled stevedoring system is operational and ready for maritime operations.</strong></p>
            <div style="margin-top: 20px;">
                <a href="{{ url_for('auth.logout') }}" class="btn">Logout</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}